<!doctype html>

<html lang="it">
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="author" content="Daniele Trevisanello">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

<nav class="navbar navbar-dark bg-dark sticky-top">
  <div class="container">
    <a class="navbar-brand text-light mb-0 h1">COVID-19 - Situazione Italiana</a>
    <span class="navbar-text">
      <strong>Ultimo Aggiornamento:</strong> <span class="ultimoAggiornamento"></span>
    </span>
  </div>
</nav>
<div class="container">
  <p class="pt-4 text-center">Questo <strong>NON</strong> Ã¨ un sito ufficiale. I dati vengono prelevati in automatico dal github della <a href="https://github.com/pcm-dpc/COVID-19">Presidenza del Consiglio dei Ministri - Dipartimento di Protezione Civile</a> pertanto sono sempre aggiornati.</p>
  <hr class="py-4">
 
  <section>
    <div class="row">
      <div class="col-sm-3 text-center">
        <p class="lead" style="color:#3ba8d5"><b>Isolamento Domiciliare</b><br>
        <span class="totaleIsolamentoDomiciliare h1"></span></p>
        <p class="lead" style="color:#d5753b"><b>Terapia Intensiva</b><br>
        <span class="totaleTerapiaIntensiva h1"></span></p>
        <p class="lead" style="color:#d5c53b"><b>Ricoverati</b><br>
        <span class="totaleRicoverati h1"></span></p>
      </div>
      <div class="col-sm-3 text-center">
        <p class="lead" style="color:#3bd55f"><b>Guariti</b><br>
        <span class="totaleGuariti h1"></span></p>
        <p class="lead" style="color:#d53b3b"><b>Deceduti</b><br>
        <span class="totaleDeceduti h1"></span></p>
        <p class="lead text-secondary"><b>Tamponi</b><br>
        <span class="totaleTamponi h1"></span></p>
      </div>
      <div class="col-sm-6">
        <canvas id="doughnut"></canvas>
      </div>
    </div>
  </section>
  <hr class="py-4">
  <section>
    <h4 class="pb-2 text-center">Situazione Nazionale Complessiva</h3>
    <canvas id="situazioneNazionaleChart"></canvas>
    <hr class="py-4">
    <h4 class="pb-2 text-center">Nuovi Attualmente Positivi vs Tamponi Effettuati per Giorno</h3>
    <canvas id="nuoviInfettiChart"></canvas>
    <hr class="py-4">
    <h4 class="pb-2 text-center">Dimessi Guariti vs Deceduti per Giorno</h3>
    <canvas id="dimessiVsDecedutiChart"></canvas>
  </section>
  <hr class="py-4">
  <p class="text-center"><small>Made by <a href="https://github.com/dan88v">dan88v</a> using <a href="https://www.chartjs.org/">Chart.js</a><br>
  Data source: <a href="https://github.com/pcm-dpc/COVID-19">pcm-dpc</a></small></p>
</div>

<script>
  d3.csv('https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale-latest.csv')
    .then(makeDashboard);
  function makeDashboard(a) {

  $('span.ultimoAggiornamento').text(a[0].data);
  $('span.totaleTamponi').text(a[0].tamponi);
  $('span.totaleRicoverati').text(a[0].ricoverati_con_sintomi);
  $('span.totaleGuariti').text(a[0].dimessi_guariti);
  $('span.totaleDeceduti').text(a[0].deceduti);
  $('span.totaleIsolamentoDomiciliare').text(a[0].isolamento_domiciliare);
  $('span.totaleTerapiaIntensiva').text(a[0].terapia_intensiva);

  var labels = [
      'Ricoverati', 
      'Terapia Intensiva',
      'Isolamento Domiciliare',
      'Guariti',
      'Deceduti',
    ];
    var graphData = [
      a[0].ricoverati_con_sintomi,
      a[0].terapia_intensiva,
      a[0].isolamento_domiciliare,
      a[0].dimessi_guariti,
      a[0].deceduti
    ];
  
    var chart = new Chart('doughnut', {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [
          {
            data: graphData,
            backgroundColor: ['#d5c53b', '#d5753b', '#3ba8d5', '#3bd55f', '#d53b3b'],
          }
        ],
      },
      options: {
          legend: {
            display: false,
          }
        }
    });
  }

</script>

<script>
  d3.csv('https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv')
    .then(makeChart);
  
  function makeChart(a) {
  
    var labels = a.map(function(d) {return (d.data).substring(5,10)});
    var rcs = a.map(function(d) {return d.ricoverati_con_sintomi});
    var ti = a.map(function(d) {return d.terapia_intensiva});
    var id = a.map(function(d) {return d.isolamento_domiciliare});
    var dg = a.map(function(d) {return d.dimessi_guariti});
    var dec = a.map(function(d) {return d.deceduti});

    var chartData = {
        labels: labels,
        datasets: [{
          label: 'Ricoverati con Sintomi',
          data: rcs,
          backgroundColor: '#d5c53b',
			lineTension: 0
        }, {
          label: 'Terapia Intensiva',
          data: ti,
          backgroundColor: '#d5753b',
			lineTension: 0
        }, {
          label: 'Isolamento Domiciliare',
          data: id,
          backgroundColor: '#3ba8d5',
			lineTension: 0
        }, {
          label: 'Dimessi Guariti',
          data: dg,
          backgroundColor: '#3bd55f',
			lineTension: 0
        }, {
          label: 'Deceduti',
          data: dec,
          backgroundColor: '#d53b3b',
			lineTension: 0
        }]
      };
  
    var chart = new Chart('situazioneNazionaleChart', {
      type: 'line',
      data: chartData,
      options: {
        title: {
            display: false,
            text: 'Situazione Nazionale'
          },
          tooltips: {
            mode: 'index',
            intersect: false
          },
          responsive: true,
          scales: {
            xAxes: [{
              stacked: true,
            }],
            yAxes: [{
              stacked: true
            }]
          }
        }
    });
  }
</script>

<script>
  d3.csv('https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv')
    .then(makeChart);
  
  function makeChart(a) {
  
    var labels = a.map(function(d) {return (d.data).substring(5,10)});
    var ni = a.map(function(d) {return d.nuovi_attualmente_positivi});
    var t = a.map(function(d) {return d.tamponi});
    
    var tgiorn = new Array;
    for (var i=0;i<t.length;i++)
    {
      tgiorn[i] = t[i] - t[i-1];
      if (i==0) tgiorn[i] = parseInt(t[i]);
    }

    var chartData = {
        labels: labels,
        datasets: [{
          label: 'Nuovi Positivi',
          data: ni,
          backgroundColor: '#616161',
        }, {
          label: 'Tamponi',
          data: tgiorn,
          backgroundColor: '#72b1ff',
        }]
      };
  
    var chart = new Chart('nuoviInfettiChart', {
      type: 'bar',
      data: chartData,
      options: {
        title: {
            display: false,
            text: 'Nuovi Positivi'
          },
          tooltips: {
            mode: 'index',
            intersect: false
          },
          responsive: true,
        }
    });
  }
</script>

<script>
  d3.csv('https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv')
    .then(makeChart);
  
  function makeChart(a) {
  
    var labels = a.map(function(d) {return (d.data).substring(5,10)});

    var dg = a.map(function(d) {return d.dimessi_guariti});
    var dggiorn = new Array;
    for (var i=0;i<dg.length;i++)
    {
      dggiorn[i] = dg[i] - dg[i-1];
      if (i==0) dggiorn[i] = parseInt(dg[i]);
    }

    var dec = a.map(function(d) {return d.deceduti});
    var decgiorn = new Array;
    for (var i=0;i<dec.length;i++)
    {
      decgiorn[i] = dec[i] - dec[i-1];
      if (i==0) decgiorn[i] = parseInt(dec[i]);
    }

    var chartData = {
        labels: labels,
        datasets: [{
          label: 'Dimessi',
          data: dggiorn,
          fill: false,
          borderColor: '#239942',
			lineTension: 0.2
        }, {
          label: 'Deceduti',
          data: decgiorn,
          fill: false,
          borderColor: '#992323',
			lineTension: 0.2
        }]
      };
  
    var chart = new Chart('dimessiVsDecedutiChart', {
      type: 'line',
      data: chartData,
      options: {
        title: {
            display: false,
            text: 'Dimessi Guariti vs Deceduti per Giorno'
          },
          tooltips: {
            mode: 'index',
            intersect: false
          },
          responsive: true,
        }
    });
  }
  </script>


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>